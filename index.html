<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <title>Alpha Scout</title>
    <meta name="description" content="Real-Time Crypto Intelligence">
    
    <link id="favicon" rel="icon" href="https://i.postimg.cc/0yf3NkFZ/photo-5951938547948391284-y.jpg">
    <link id="shortcut" rel="shortcut icon" href="https://i.postimg.cc/0yf3NkFZ/photo-5951938547948391284-y.jpg">
    <link id="app-icon" rel="apple-touch-icon" href="https://i.postimg.cc/0yf3NkFZ/photo-5951938547948391284-y.jpg">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Alpha Scout">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#f0f9ff">

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

    <style>
        /* THE VIBE: Sky Blue & Clean */
        :root {
            --bg-gradient: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #bae6fd 100%);
            --glass-bg: rgba(255, 255, 255, 0.4);
            --glass-border: rgba(255, 255, 255, 0.6);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
            --glass-blur: blur(20px);
            --text-main: #0f172a;
            --text-muted: #475569;
            --accent: #0ea5e9;
            --pump: #16a34a;
            --dump: #dc2626;
        }

        body {
            margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg-gradient); background-attachment: fixed;
            color: var(--text-main); min-height: 100vh;
            display: flex; justify-content: center; 
            padding: 20px 10px; padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom);
            -webkit-tap-highlight-color: transparent;
        }

        .container { width: 100%; max-width: 600px; padding-bottom: 60px; min-height: 85vh; display: flex; flex-direction: column; }

        /* HEADER */
        header { margin-bottom: 20px; text-align: center; position: relative; }
        .logo-area { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 5px; }
        .app-logo { width: 40px; height: 40px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); object-fit: cover; }
        h1 { font-weight: 800; font-size: 2rem; margin: 0; letter-spacing: -1px; color: var(--text-main); }
        .subtitle { color: var(--accent); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1.5px; font-weight: 600; opacity: 0.9; }
        .news-toggle {
            position: absolute; right: 0; top: 10px; cursor: pointer;
            background: var(--glass-bg); padding: 10px; border-radius: 50%;
            font-size: 1.2rem; transition: 0.2s; border: 1px solid var(--glass-border);
        }
        .news-toggle:active { transform: scale(0.95); }

        /* TICKER */
        .news-ticker-wrap {
            width: 100%; overflow: hidden; background: #fff; 
            border: 1px solid var(--glass-border); border-radius: 12px; margin-bottom: 20px; 
            white-space: nowrap; font-size: 0.8rem; padding: 12px 0;
            box-shadow: var(--glass-shadow); color: var(--text-main); display: none;
        }
        .ticker-item { display: inline-block; padding-left: 100%; animation: ticker 40s linear infinite; }
        .ticker-headline { margin-right: 40px; cursor: pointer; color: var(--text-muted); font-weight: 500; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        /* CARDS */
        .card {
            background: var(--glass-bg); backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border); border-radius: 20px; padding: 20px;
            margin-bottom: 15px; box-shadow: var(--glass-shadow);
        }
        
        /* HEADER STATS & LIGHT */
        .stats-row { display: flex; justify-content: space-between; align-items: center; }
        .stat-item { text-align: left; }
        .stat-label { font-size: 0.7rem; color: var(--text-muted); font-weight: 700; text-transform: uppercase; }
        .stat-val { font-size: 1.1rem; font-weight: 800; color: var(--text-main); }
        
        .refresh-group { display: flex; align-items: center; gap: 10px; }
        .status-light { width: 12px; height: 12px; border-radius: 50%; background: #ccc; box-shadow: 0 0 5px rgba(0,0,0,0.1); transition:0.3s; }
        .status-online { background: #16a34a; box-shadow: 0 0 8px #16a34a; }
        .status-offline { background: #dc2626; box-shadow: 0 0 8px #dc2626; }

        .btn-refresh {
            background: #fff; border: 1px solid #fff; color: var(--accent);
            padding: 10px 18px; border-radius: 30px; font-size: 0.75rem; font-weight: 700;
            cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .btn-refresh:active { transform: scale(0.95); }

        /* SEARCH BAR */
        .search-box { position: relative; margin-bottom: 20px; }
        .search-input {
            width: 100%; padding: 14px 20px; border-radius: 16px;
            border: 1px solid var(--glass-border); background: rgba(255,255,255,0.6);
            font-size: 16px; color: var(--text-main); box-sizing: border-box;
            backdrop-filter: blur(10px); transition: 0.2s;
        }
        .search-input:focus { outline: none; background: #fff; box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1); }
        #search-results {
            position: absolute; top: 60px; left: 0; width: 100%; background: #fff;
            border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            z-index: 50; max-height: 250px; overflow-y: auto; display: none;
        }
        .search-item { padding: 15px; border-bottom: 1px solid #f1f5f9; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .search-item:active { background: #f8fafc; }

        /* TABS */
        .tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: nowrap; overflow-x: auto; -webkit-overflow-scrolling: touch; padding-bottom: 5px; }
        .tab {
            flex: 1; padding: 12px; text-align: center; cursor: pointer; min-width: 70px;
            background: rgba(255,255,255,0.3); border-radius: 12px; white-space: nowrap;
            font-weight: 700; font-size: 0.8rem; color: var(--text-muted); transition: 0.2s;
        }
        .tab.active { background: #fff; color: var(--accent); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }

        /* ORACLE & HEATMAP */
        .oracle-container { height: 425px; border-radius: 16px; overflow: hidden; border: 1px solid var(--glass-border); background: #fff; }
        .oracle-controls { display: flex; gap: 8px; margin-bottom: 15px; }
        .oracle-btn {
            flex: 1; border: 1px solid var(--glass-border); background: rgba(255,255,255,0.5);
            padding: 8px; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 0.8rem; color: var(--text-muted);
            transition: 0.2s;
        }
        .oracle-btn.active { background: #fff; color: var(--accent); box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-color: #fff; }
        #heatmap-card { padding: 0; overflow: hidden; height: 500px; border: 1px solid var(--glass-border); background: #fff; }
        #heatmap-embed { width: 100%; height: 100%; }

        /* LISTS */
        .list-container { display: flex; flex-direction: column; gap: 10px; }
        .row {
            display: flex; align-items: center; justify-content: space-between;
            padding: 14px; border-radius: 14px; cursor: pointer;
            background: rgba(255,255,255,0.4); transition: 0.2s; border: 1px solid transparent;
        }
        .row:active { background: #fff; transform: scale(0.98); }
        .row-left { display: flex; align-items: center; gap: 12px; }
        .row-img { width: 36px; height: 36px; border-radius: 50%; }
        .row-name { font-weight: 700; font-size: 0.95rem; color: var(--text-main); }
        .row-sub { font-size: 0.75rem; color: var(--text-muted); font-weight: 600; display: flex; align-items: center; gap: 6px; }
        .row-right { text-align: right; }
        .row-price { font-family: 'SF Mono', monospace; font-size: 0.95rem; font-weight: 700; }
        .pump { color: #16a34a !important; } 
        .dump { color: #dc2626 !important; }

        /* BADGES */
        .badge { padding: 2px 6px; border-radius: 4px; font-size: 0.6rem; color: white; font-weight: 700; text-transform: uppercase; }
        .bg-solana { background: #9945FF; }
        .bg-base { background: #0052FF; }
        .bg-eth { background: #627EEA; }

        /* CALCULATOR */
        .calc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; }
        .inp-group label { display: block; font-size: 0.7rem; color: var(--text-muted); margin-bottom: 5px; font-weight: 700; }
        .inp-group input { 
            width: 100%; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.5); 
            background: rgba(255,255,255,0.5); font-family: monospace; box-sizing: border-box; font-size: 16px;
        }
        .res-box { margin-top: 15px; padding: 20px; background: #ecfdf5; border-radius: 16px; text-align: center; border: 1px solid #d1fae5; }

        /* WHALE TOOLS */
        .whale-input { display: flex; gap: 10px; margin-bottom: 20px; }
        .whale-tools { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .tool-btn { 
            padding: 15px; border: 1px solid rgba(255,255,255,0.8); border-radius: 16px; background: #fff;
            text-align: center; cursor: pointer; font-weight: 700; font-size: 0.85rem; color: var(--text-main); 
            display: flex; flex-direction: column; align-items: center; gap: 5px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .tool-btn:active { transform: scale(0.98); }

        /* MODAL */
        .modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(15px); 
            display: none; justify-content: center; align-items: center; z-index: 999; 
        }
        
        /* Modal Transitions */
        .modal-content { 
            background: #fff; width: 92%; max-width: 800px; height: 75vh; 
            border-radius: 24px; padding: 20px; display: flex; flex-direction: column; 
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
            transition: all 0.3s ease;
        }
        
        /* FULL SCREEN CLASS */
        .modal-content.full-screen {
            width: 100vw; height: 100vh; max-width: none; border-radius: 0; padding: 10px;
        }

        .modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; }
        .modal-title-box { display:flex; align-items:center; gap:12px; }
        .modal-actions { display:flex; gap:10px; }
        
        .close-btn { 
            background: #f1f5f9; border: none; padding: 10px 16px; border-radius: 12px; 
            cursor: pointer; font-weight: 700; font-size: 0.9rem; color: var(--text-main);
        }
        .close-btn:active { background: #e2e8f0; }
        
        #chart-container { flex-grow: 1; border-radius: 16px; overflow: hidden; background: #fff; border: 1px solid #e2e8f0; }
        
        .hidden { display: none; }
        .loader { text-align: center; padding: 30px; font-size: 0.85rem; color: var(--text-muted); font-weight: 600; }
        .attribution { margin-top: auto; padding-top: 30px; text-align: center; font-size: 0.65rem; color: var(--text-muted); opacity: 0.6; font-weight: 500; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <div class="logo-area">
                <img id="display-logo" class="app-logo" src="">
                <h1>Alpha Scout</h1>
            </div>
            <div class="subtitle">Real-Time Intelligence & Sniper Tools</div>
            <div class="news-toggle" onclick="toggleNews()" title="Enable News Ticker">üì°</div>
        </header>

        <div class="news-ticker-wrap" id="news-wrap"><div class="ticker-item" id="news-ticker">Connecting...</div></div>

        <div class="card stats-row">
            <div class="stat-item"><div class="stat-label">Bitcoin</div><div class="stat-val" id="btc-price">...</div></div>
            <div class="stat-item"><div class="stat-label">Solana</div><div class="stat-val" id="sol-price">...</div></div>
            <div class="refresh-group"><div class="status-light" id="status-dot"></div><button class="btn-refresh" onclick="refreshAll()">Refresh</button></div>
        </div>

        <div class="search-box">
            <input type="text" class="search-input" id="search-input" placeholder="Search (e.g. PEPE)..." onkeyup="handleSearch(event)">
            <div id="search-results"></div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="setTab('market')" id="tab-market">Market</div>
            <div class="tab" onclick="setTab('degen')" id="tab-degen">Degen</div>
            <div class="tab" onclick="setTab('map')" id="tab-map">Heat map</div>
            <div class="tab" onclick="setTab('oracle')" id="tab-oracle">Oracle</div>
            <div class="tab" onclick="setTab('whale')" id="tab-whale">Whale</div>
            <div class="tab" onclick="setTab('calc')" id="tab-calc">Calc</div>
        </div>

        <div id="view-market">
            <div class="card"><div class="section-title" style="margin-bottom:15px; font-size:0.8rem; font-weight:700; color:var(--text-muted)">üöÄ Top Gainers (24h)</div><div id="list-gainers" class="list-container"><div class="loader">Loading Market...</div></div></div>
            <div class="card"><div class="section-title" style="margin-bottom:15px; font-size:0.8rem; font-weight:700; color:var(--text-muted)">üî• Trending Search</div><div id="list-trending" class="list-container"><div class="loader">Loading Trends...</div></div></div>
        </div>

        <div id="view-degen" class="hidden">
            <div class="card"><div class="section-title" style="margin-bottom:15px; color:var(--accent); font-size:0.8rem; font-weight:700;">üÜï Fresh Profiles (Verified)</div><div id="list-new" class="list-container"><div class="loader">Fetching Alpha...</div></div></div>
        </div>

        <div id="view-map" class="hidden">
            <div class="card" id="heatmap-card"><div id="heatmap-embed"></div></div>
        </div>

        <div id="view-oracle" class="hidden">
            <div class="card">
                <div class="section-title" style="margin-bottom:15px; color:var(--text-main); font-size:0.9rem; font-weight:800;">üì° Technical Analysis Radar</div>
                <div class="oracle-controls">
                    <button class="oracle-btn active" onclick="updateOracle('BINANCE:BTCUSDT', this)">BTC</button>
                    <button class="oracle-btn" onclick="updateOracle('BINANCE:ETHUSDT', this)">ETH</button>
                    <button class="oracle-btn" onclick="updateOracle('BINANCE:SOLUSDT', this)">SOL</button>
                </div>
                <div class="oracle-container" id="oracle-widget"></div>
            </div>
        </div>

        <div id="view-whale" class="hidden">
            <div class="card">
                <div class="section-title" style="margin-bottom:15px; font-size:0.8rem; font-weight:700; color:var(--text-muted)">üêã Wallet Tracker</div>
                <div class="whale-input"><input type="text" class="search-input" id="w-address" placeholder="Paste Wallet Address (0x... or sol...)"></div>
                <div class="whale-tools">
                    <div onclick="openTool('arkham')" class="tool-btn">üëÅÔ∏è<br>Arkham</div>
                    <div onclick="openTool('debank')" class="tool-btn">üí∞<br>DeBank</div>
                    <div onclick="openTool('explorer')" class="tool-btn">üîó<br>Explorer</div>
                </div>
            </div>
        </div>

        <div id="view-calc" class="hidden">
            <div class="card">
                <div class="section-title" style="font-size:0.8rem; font-weight:700; color:var(--text-muted)">‚ö° PnL & Leverage Calculator</div>
                <div class="calc-grid">
                    <div class="inp-group"><label>Collateral ($)</label><input type="number" id="lev-margin" placeholder="100" oninput="calcLeverage()"></div>
                    <div class="inp-group"><label>Leverage (x)</label><input type="number" id="lev-x" placeholder="20" oninput="calcLeverage()"></div>
                    <div class="inp-group"><label>Entry Price</label><input type="number" id="lev-entry" placeholder="Entry" oninput="calcLeverage()"></div>
                    <div class="inp-group"><label>Exit Price</label><input type="number" id="lev-exit" placeholder="Target" oninput="calcLeverage()"></div>
                </div>
                <div class="res-box">
                    <div class="stat-val" id="lev-profit" style="color:var(--pump)">$0.00 Profit</div>
                    <div class="stat-label" id="lev-roi">0% ROI</div>
                    <div style="margin-top:10px; font-size:0.9rem; color:var(--text-muted);" id="lev-total">Total Exposure: $0</div>
                </div>
            </div>
        </div>

        <div class="attribution">Powered by CoinGecko, DexScreener & Cointelegraph</div>
    </div>

    <div id="modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title-box">
                    <img id="m-img" src="" style="width:32px; border-radius:50%">
                    <div class="stat-val" style="font-size:1.2rem" id="modal-title">Chart</div>
                </div>
                <div class="modal-actions">
                    <button class="close-btn" onclick="toggleFullScreen()" title="Full Screen">‚§¢</button>
                    <button class="close-btn" onclick="closeModal()">Close</button>
                </div>
            </div>
            <div id="chart-container"></div>
        </div>
    </div>

    <script>
        const CONFIG = { logo: 'https://i.postimg.cc/0yf3NkFZ/photo-5951938547948391284-y.jpg' };
        document.getElementById('app-icon').href = CONFIG.logo;
        document.getElementById('display-logo').src = CONFIG.logo;
        document.getElementById('m-img').src = CONFIG.logo;

        // MOCK DATA
        const MOCK_MARKET = [
            { id: "bitcoin", name: "Bitcoin", symbol: "btc", image: CONFIG.logo, current_price: 95000, price_change_percentage_24h: 2.5 },
            { id: "ethereum", name: "Ethereum", symbol: "eth", image: "https://assets.coingecko.com/coins/images/279/small/ethereum.png", current_price: 2700, price_change_percentage_24h: 1.2 },
            { id: "solana", name: "Solana", symbol: "sol", image: "https://assets.coingecko.com/coins/images/4128/small/solana.png", current_price: 135, price_change_percentage_24h: -0.5 },
            { id: "pepe", name: "Pepe", symbol: "pepe", image: "https://assets.coingecko.com/coins/images/29850/small/pepe-token.jpeg", current_price: 0.00001, price_change_percentage_24h: 15.0 },
            { id: "wif", name: "dogwifhat", symbol: "wif", image: "https://assets.coingecko.com/coins/images/33566/small/dogwifhat.jpg", current_price: 2.50, price_change_percentage_24h: 5.5 }
        ];
        const MOCK_DEGEN = [
            { name: "CHILL GUY", symbol: "CHILL", image: "https://assets.coingecko.com/coins/images/4128/small/solana.png", current_price: 0.002, url: "https://dexscreener.com/solana", chainId: "solana", price_change_percentage_24h: 20 },
            { name: "MOODENG", symbol: "MOODENG", image: "https://assets.coingecko.com/coins/images/4128/small/solana.png", current_price: 0.15, url: "https://dexscreener.com/solana", chainId: "solana", price_change_percentage_24h: -5 }
        ];

        let oracleLoaded = false; let mapLoaded = false; let newsLoaded = false;

        function setStatus(isOnline) {
            const dot = document.getElementById('status-dot');
            if(isOnline) { dot.classList.remove('status-offline'); dot.classList.add('status-online'); }
            else { dot.classList.remove('status-online'); dot.classList.add('status-offline'); }
        }

        function setTab(view) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`tab-${view}`).classList.add('active');
            ['market', 'degen', 'calc', 'oracle', 'map', 'whale'].forEach(v => document.getElementById(`view-${v}`).classList.add('hidden'));
            document.getElementById(`view-${view}`).classList.remove('hidden');

            if(view === 'degen' && document.getElementById('list-new').innerHTML.includes('Fetching')) fetchDegen();
            if(view === 'oracle' && !oracleLoaded) { updateOracle('BINANCE:BTCUSDT'); oracleLoaded = true; }
            if(view === 'map' && !mapLoaded) { initHeatmap(); }
        }

        function updateOracle(symbol, btn) {
            if(btn) { document.querySelectorAll('.oracle-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
            const container = document.getElementById('oracle-widget'); container.innerHTML = ""; 
            const script = document.createElement('script'); script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-technical-analysis.js';
            script.async = true; script.innerHTML = JSON.stringify({ "interval": "1h", "width": "100%", "isTransparent": false, "height": "100%", "symbol": symbol, "showIntervalTabs": true, "displayMode": "single", "locale": "en", "colorTheme": "light" });
            container.appendChild(script);
        }
        function initHeatmap() {
            if(mapLoaded) return;
            const container = document.getElementById('heatmap-embed'); container.innerHTML = ""; 
            const script = document.createElement('script'); script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-crypto-coins-heatmap.js';
            script.async = true; script.innerHTML = JSON.stringify({ "dataSource": "Crypto", "blockSize": "market_cap_calc", "blockColor": "change", "locale": "en", "symbolUrl": "", "colorTheme": "light", "hasTopBar": false, "isDataSetEnabled": false, "isZoomEnabled": true, "hasSymbolTooltip": true, "width": "100%", "height": "100%" });
            container.appendChild(script); mapLoaded = true;
        }

        async function refreshAll() {
            const btn = document.querySelector('.btn-refresh'); btn.innerText = "...";
            await fetchMarket(); await fetchDegen(); if(newsLoaded) await fetchNews();
            btn.innerText = "Refresh";
        }

        async function fetchMarket() {
            try {
                const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=100&page=1&sparkline=false&price_change_percentage=24h');
                if(!res.ok) throw new Error("Limit");
                const data = await res.json();
                updateHeader(data);
                const gainers = [...data].sort((a,b) => b.price_change_percentage_24h - a.price_change_percentage_24h).slice(0, 5);
                renderList('list-gainers', gainers, 'cex');
                const trendRes = await fetch('https://api.coingecko.com/api/v3/search/trending');
                const trendData = await trendRes.json();
                const trendCoins = trendData.coins.slice(0,5).map(c => ({
                    name: c.item.name, symbol: c.item.symbol, image: c.item.small,
                    current_price: c.item.data.price,
                    price_change_percentage_24h: c.item.data.price_change_percentage_24h.usd
                }));
                renderList('list-trending', trendCoins, 'cex');
                setStatus(true);
            } catch(e) {
                console.log("Mock Mode"); setStatus(false);
                updateHeader(MOCK_MARKET);
                renderList('list-gainers', MOCK_MARKET, 'cex');
                renderList('list-trending', MOCK_MARKET, 'cex');
            }
        }

        function updateHeader(data) {
            const btc = data.find(c => c.id === 'bitcoin'); const sol = data.find(c => c.id === 'solana');
            if(btc) document.getElementById('btc-price').innerHTML = `<span style="color:${btc.price_change_percentage_24h>=0?'#16a34a':'#dc2626'}">$${btc.current_price.toLocaleString()}</span>`;
            if(sol) document.getElementById('sol-price').innerHTML = `<span style="color:${sol.price_change_percentage_24h>=0?'#16a34a':'#dc2626'}">$${sol.current_price.toLocaleString()}</span>`;
        }

        async function fetchDegen() {
            try {
                const profRes = await fetch('https://api.dexscreener.com/token-profiles/latest/v1');
                if(!profRes.ok) throw new Error("Limit");
                const profiles = await profRes.json();
                const top10 = profiles.slice(0, 10);
                const addresses = top10.map(p => p.tokenAddress).join(',');
                const detailRes = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${addresses}`);
                const details = await detailRes.json();
                const combined = top10.map(p => {
                    const match = details.pairs ? details.pairs.find(pair => pair.baseToken.address === p.tokenAddress) : null;
                    return { name: match ? match.baseToken.name : "Unknown", symbol: match ? match.baseToken.symbol : "NEW", image: p.icon || CONFIG.logo, current_price: match ? parseFloat(match.priceUsd) : 0, url: p.url, chainId: p.chainId };
                });
                renderList('list-new', combined, 'dex');
            } catch(e) { renderList('list-new', MOCK_DEGEN, 'dex'); }
        }

        function renderList(id, data, type) {
            const container = document.getElementById(id); container.innerHTML = '';
            data.forEach(c => {
                const div = document.createElement('div'); div.className = 'row';
                
                if(type === 'cex') {
                    const chartSym = `BINANCE:${c.symbol.toUpperCase()}USDT`;
                    div.onclick = function() { launchModal(c.name, c.image, chartSym); };
                } else {
                    div.onclick = function() { window.open(c.url, '_blank'); };
                }

                const price = c.current_price < 1 ? c.current_price.toFixed(6) : c.current_price.toLocaleString();
                const change = c.price_change_percentage_24h ? c.price_change_percentage_24h.toFixed(2) + '%' : 'New';
                const colorClass = (c.price_change_percentage_24h >= 0 || c.price_change_percentage_24h === undefined) ? 'pump' : 'dump';
                let badge = '';
                if(type === 'dex' && c.chainId) {
                    if(c.chainId === 'solana') badge = '<span class="badge bg-solana">SOL</span>';
                    else if(c.chainId === 'base') badge = '<span class="badge bg-base">BASE</span>';
                    else if(c.chainId === 'ethereum') badge = '<span class="badge bg-eth">ETH</span>';
                }
                div.innerHTML = `<div class="row-left"><img src="${c.image}" class="row-img"><div><div class="row-name">${c.name}</div><div class="row-sub">${badge} ${c.symbol}</div></div></div><div class="row-right"><div class="row-price ${colorClass}">$${price}</div><div class="row-sub ${colorClass}">${change}</div></div>`;
                container.appendChild(div);
            });
        }

        function toggleNews() { const wrap = document.getElementById('news-wrap'); if(wrap.style.display === 'block') { wrap.style.display = 'none'; } else { wrap.style.display = 'block'; if(!newsLoaded) { fetchNews(); newsLoaded = true; } } }
        async function fetchNews() { try { const res = await fetch('https://api.rss2json.com/v1/api.json?rss_url=https://cointelegraph.com/rss'); const data = await res.json(); let html = ''; data.items.slice(0, 10).forEach(item => { const title = item.title.replace(/<[^>]*>?/gm, ''); html += `<span class="ticker-headline" onclick="window.open('${item.link}', '_blank')">üî• ${title}</span>`; }); document.getElementById('news-ticker').innerHTML = html; } catch (e) { document.getElementById('news-ticker').innerText = "News Unavailable"; } }

        async function handleSearch(e) {
            if(e.key === 'Enter') {
                const q = document.getElementById('search-input').value; if(!q) return;
                try {
                    const res = await fetch(`https://api.coingecko.com/api/v3/search?query=${q}`);
                    const data = await res.json();
                    const box = document.getElementById('search-results'); box.innerHTML = ''; box.style.display = 'block';
                    data.coins.slice(0,5).forEach(c => {
                        const item = document.createElement('div'); item.className = 'search-item';
                        item.innerHTML = `<img src="${c.thumb}" width="20"> <b>${c.name}</b> (${c.symbol})`;
                        const chartSym = `BINANCE:${c.symbol.toUpperCase()}USDT`;
                        item.onclick = function() { launchModal(c.name, c.large, chartSym); box.style.display = 'none'; };
                        box.appendChild(item);
                    });
                } catch(e) { alert("Search Limit"); }
            }
        }

        function calcLeverage() {
            const margin = parseFloat(document.getElementById('lev-margin').value); const leverage = parseFloat(document.getElementById('lev-x').value); const entry = parseFloat(document.getElementById('lev-entry').value); const exit = parseFloat(document.getElementById('lev-exit').value);
            if(!margin || !leverage || !entry || !exit) return;
            const totalExposure = margin * leverage; const positionSize = totalExposure / entry; const profit = (exit - entry) * positionSize; const roi = (profit / margin) * 100;
            document.getElementById('lev-profit').innerText = "$" + profit.toFixed(2) + " Profit"; document.getElementById('lev-roi').innerText = roi.toFixed(2) + "% ROI"; document.getElementById('lev-total').innerText = "Total Exposure: $" + totalExposure.toLocaleString();
            const resBox = document.querySelector('.res-box'); if(profit >= 0) { resBox.style.background = "#ecfdf5"; resBox.style.borderColor = "#6ee7b7"; document.getElementById('lev-profit').style.color = "#10b981"; } else { resBox.style.background = "#fef2f2"; resBox.style.borderColor = "#fca5a5"; document.getElementById('lev-profit').style.color = "#dc2626"; }
        }

        function openTool(tool) {
            const addr = document.getElementById('w-address').value.trim(); if(!addr) { alert("Paste a wallet address first!"); return; }
            let url = '';
            if(tool === 'arkham') url = `https://platform.arkhamintelligence.com/explorer/address/${addr}`;
            if(tool === 'debank') url = `https://debank.com/profile/${addr}`;
            if(tool === 'explorer') { if(addr.length > 40 && !addr.startsWith('0x')) url = `https://solscan.io/account/${addr}`; else url = `https://etherscan.io/address/${addr}`; }
            window.open(url, '_blank');
        }

        // --- FULL SCREEN MODAL LOGIC ---
        const modal = document.getElementById('modal');
        const chartContainer = document.getElementById('chart-container');

        function toggleFullScreen() {
            document.querySelector('.modal-content').classList.toggle('full-screen');
        }

        function launchModal(name, img, symbol) {
            document.getElementById('modal-title').innerText = name;
            document.getElementById('m-img').src = img || CONFIG.logo;
            chartContainer.innerHTML = ''; 
            modal.style.display = 'flex';
            
            // Immediate Chart Init (V17 Logic)
            new TradingView.widget({
                "autosize": true,
                "symbol": symbol,
                "interval": "D",
                "timezone": "Etc/UTC",
                "theme": "light",
                "style": "1",
                "locale": "en",
                "toolbar_bg": "#f1f3f6",
                "enable_publishing": false,
                "allow_symbol_change": true,
                "container_id": "chart-container"
            });
        }

        function closeModal() {
            modal.style.display = 'none';
            chartContainer.innerHTML = '';
            document.querySelector('.modal-content').classList.remove('full-screen'); // Reset
        }

        // Init
        fetchMarket();
    </script>
</body>
</html>
